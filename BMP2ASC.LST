Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 1
bmp2asc.ASM



      1
      2				     ; Tarea Programada	- BMP to Ascii
      3
      4				     ; David Castro H -	2018105813
      5
      6				     ;------------------------------------------------------------------------------
      7
      8
      9				     include macroBMP.cbc
1    10				     ;--------------------------MACROS----------------------------------------------------
1    11
1    12				     ListPush  Macro lista
1    13					     IRP i,<lista>
1    14						     Push i
1    15					     EndM
1    16					 EndM
1    17				     ;------------------------------------------------------------------------------
1    18
1    19				     ListPop  Macro lista
1    20					 IRP i,<lista>
1    21					     Pop i
1    22					     EndM
1    23					 EndM
1    24				     ;------------------------------------------------------------------------------
1    25
1    26				     PushReg Macro
1    27					 ListPush <Ax, Bx, Cx, Dx, Si, Di, Bp, Sp>
1    28					     EndM
1    29				     ;------------------------------------------------------------------------------
1    30
1    31				     PopReg Macro
1    32					     ListPush <Sp,Bp,Di,Si,Dx,Cx,Bx,Ax>
1    33					     EndM
1    34
1    35				     ;------------------------------------------------------------------------------
1    36
1    37				     IniciaSegDatos Macro
1    38					     xor ax,ax
1    39					     mov ax,datos
1    40					     mov ds,ax
1    41					     EndM
1    42				     ;------------------------------------------------------------------------------
1    43
1    44				     print Macro
1    45					     mov ah,0
1    46					 mov al,2
1    47					 int 10h
1    48					 mov ah,09h
1    49					 int 21h
1    50					     exit
1    51					     EndM
1    52
1    53				     ;------------------------------------------------------------------------------
1    54
1    55				     exit Macro
1    56					     mov ax, 4c00h
1    57					 int 21h
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 2
bmp2asc.ASM



1    58					     EndM
1    59
     60
     61
     62	0000			     SPila Segment para	Stack 'Stack'
     63	0000  40*(53 65	67 53 74  +	  db 64	Dup ('SegStack ')
     64	      61 63 6B 20)
     65	0240			     SPila EndS
     66
     67				     ;------------------------------------------------------------------------------
     68
     69
     70	0000			     SDato Segment para	public 'Data'
     71
     72
     73
     74					     ;------PARAMETROS QUE RECIBEN
     75	0000  FF*(??)				     bmp		      db     0FFh Dup (?)
     76	00FF  61 72 63 68 69 76	6F+		     archivo		      db     'archivo.txt'
     77	      2E 74 78 74
     78	010A  3F				     instruction	      db     '?'
     79	010B  FF*(??)				     password		      db     0FFh Dup (?)
     80	020A  FF*(??)				     text		      db     0FFh Dup (?)
     81	0309  00				     textSize			      db	     00
     82	030A  FF*(??)				     LineCommand	  db	     0FFh Dup (?)
     83
     84						     ;------MENSAJES PARA GUIA DE USUARIO /?
     85	0409  0A 0D 2D 2D 2D 2D	2D+		     info0			     db	     10,13,'-------------------->GUIA DE    +
     86	      2D 2D 2D 2D 2D 2D	2D+  USUARIO<---------------------------'
     87	      2D 2D 2D 2D 2D 2D	2D+
     88	      2D 3E 47 55 49 41	20+
     89	      44 45 20 55 53 55	41+
     90	      52 49 4F 3C 2D 2D	2D+
     91	      2D 2D 2D 2D 2D 2D	2D+
     92	      2D 2D 2D 2D 2D 2D	2D+
     93	      2D 2D 2D 2D 2D 2D	2D+
     94	      2D 2D 2D
     95	044B  0A 0D 42 69 65 6E	76+		     info1			     db	     10,13,'Bienvenido a la guia de	    +
     96	      65 6E 69 64 6F 20	61+  usuario:',10,13
     97	      20 6C 61 20 67 75	69+
     98	      61 20 64 65 20 75	73+
     99	      75 61 72 69 6F 3A	0A+
    100	      0D
    101	046F  0A 0D 2D 3E 20 50	61+		     info2			     db	     10,13,'-> Para convertir la imagen	a   +
    102	      72 61 20 63 6F 6E	76+  Ascii el formato es el siguiente:'
    103	      65 72 74 69 72 20	6C+
    104	      61 20 69 6D 61 67	65+
    105	      6E 20 61 20 41 73	63+
    106	      69 69 20 65 6C 20	66+
    107	      6F 72 6D 61 74 6F	20+
    108	      65 73 20 65 6C 20	73+
    109	      69 67 75 69 65 6E	74+
    110	      65 3A
    111	04B0  0A 0D 20 20 20 20	20+		     info3			     db	     10,13,'	    /a /bmp:archivo.bmp	    +
    112	      20 20 20 2F 61 20	2F+  /archivo:archivo.text',10,13
    113	      62 6D 70 3A 61 72	63+
    114	      68 69 76 6F 2E 62	6D+
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 3
bmp2asc.ASM



    115	      70 20 2F 61 72 63	68+
    116	      69 76 6F 3A 61 72	63+
    117	      68 69 76 6F 2E 74	65+
    118	      78 74 0A 0D
    119	04E5  0A 0D 2D 3E 20 50	61+		     info4			     db	     10,13,'-> Para girar la imagen el	    +
    120	      72 61 20 67 69 72	61+  formato es	el siguiente:'
    121	      72 20 6C 61 20 69	6D+
    122	      61 67 65 6E 20 65	6C+
    123	      20 66 6F 72 6D 61	74+
    124	      6F 20 65 73 20 65	6C+
    125	      20 73 69 67 75 69	65+
    126	      6E 74 65 3A
    127	051A  0A 0D 20 20 20 20	20+		     info5			     db	     10,13,'	    /d /bmp:archivo.bmp',10,+
    128	      20 20 20 2F 64 20	2F+  13
    129	      62 6D 70 3A 61 72	63+
    130	      68 69 76 6F 2E 62	6D+
    131	      70 0A 0D
    132	0539  0A 0D 20 20 20 20	2D+		     info6			     db	     10,13,'	-mensaje = el mensaje a	    +
    133	      6D 65 6E 73 61 6A	65+  encriptar.'
    134	      20 3D 20 65 6C 20	6D+
    135	      65 6E 73 61 6A 65	20+
    136	      61 20 65 6E 63 72	69+
    137	      70 74 61 72 2E
    138	0561  0A 0D 20 20 20 20	2D+		     info7			     db	     10,13,'	-archivo = el nombre del    +
    139	      61 72 63 68 69 76	6F+  archivo .txt que se utilizara.'
    140	      20 3D 20 65 6C 20	6E+
    141	      6F 6D 62 72 65 20	64+
    142	      65 6C 20 61 72 63	68+
    143	      69 76 6F 20 2E 74	78+
    144	      74 20 71 75 65 20	73+
    145	      65 20 75 74 69 6C	69+
    146	      7A 61 72 61 2E
    147	059E  0A 0D 20 20 20 20	2D+		     info8			     db	     10,13,'	-bmp	 = el nombre del    +
    148	      62 6D 70 20 20 20	20+  archivo .bmp que se utilizara.'
    149	      20 3D 20 65 6C 20	6E+
    150	      6F 6D 62 72 65 20	64+
    151	      65 6C 20 61 72 63	68+
    152	      69 76 6F 20 2E 62	6D+
    153	      70 20 71 75 65 20	73+
    154	      65 20 75 74 69 6C	69+
    155	      7A 61 72 61 2E
    156	05DB  0A 0D 2D 2D 2D 2D	2D+		     info9			     db	     10,13,				    +
    157	      2D 2D 2D 2D 2D 2D	2D+  '----------------------------------------------------------------',10,13,'$'
    158	      2D 2D 2D 2D 2D 2D	2D+
    159	      2D 2D 2D 2D 2D 2D	2D+
    160	      2D 2D 2D 2D 2D 2D	2D+
    161	      2D 2D 2D 2D 2D 2D	2D+
    162	      2D 2D 2D 2D 2D 2D	2D+
    163	      2D 2D 2D 2D 2D 2D	2D+
    164	      2D 2D 2D 2D 2D 2D	2D+
    165	      2D 2D 2D 0A 0D 24
    166	0620  0A 0D 43 6F 6D 61	6E+		     error0			     db	     10,13,'Comando incorrecto,	digite /? o +
    167	      64 6F 20 69 6E 63	6F+  /h	o /H para mas ayuda.$'
    168	      72 72 65 63 74 6F	2C+
    169	      20 64 69 67 69 74	65+
    170	      20 2F 3F 20 6F 20	2F+
    171	      68 20 6F 20 2F 48	20+
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 4
bmp2asc.ASM



    172	      70 61 72 61 20 6D	61+
    173	      73 20 61 79 75 64	61+
    174	      2E 24
    175
    176	065A  41 72 63 68 69 76	6F+		     msgInvBMP		     db		     "Archivo BMP invalido.$"
    177	      20 42 4D 50 20 69	6E+
    178	      76 61 6C 69 64 6F	2E+
    179	      24
    180	0670  45 72 72 6F 72 20	61+		     openFileError	     db		     "Error al abrir archivo.$"
    181	      6C 20 61 62 72 69	72+
    182	      20 61 72 63 68 69	76+
    183	      6F 2E 24
    184	0688  4E 6F 20 73 65 20	70+		     error1			 db	     'No se pudo crear$'
    185	      75 64 6F 20 63 72	65+
    186	      61 72 24
    187	0699  4E 6F 20 73 65 20	70+		     error2		     db	     "No se pudo escribir$"
    188	      75 64 6F 20 65 73	63+
    189	      72 69 62 69 72 24
    190	06AD  4E 6F 20 73 65 20	70+		     error3		     db	     "No se pudo cerrar$"
    191	      75 64 6F 20 63 65	72+
    192	      72 61 72 24
    193	06BF  4E 6F 20 73 65 20	70+		     error4		     db	     'No se pudo abrir$'
    194	      75 64 6F 20 61 62	72+
    195	      69 72 24
    196	06D0  ????				     filehandle			 dw	     ?
    197	06D2  ????				     txthandle			 dw	     ?
    198
    199	06D4			     SDato EndS
    200
    201				     ;-----------------------------------------------------------------------------------------------
    202				     --------------------------------------------------------
    203
    204	0000			     SCodigo Segment para public 'Code'
    205						     Assume CS:SCodigo,	SS:SPila, DS:SDato
    206
    207
    208	0000			     showInfo Proc far			   ;Esta etiqueta mueve	al muestra la guia de usuario.
    209	0000  BA 0409r				     lea     dx,info0		       ;Mueve al dx el desplazamiento del msj que   +
    210				     quiero mostrar en este caso la guia de usuario
    211						     ;jmp    print		       ;y salta	a la etiqueta print para que imprima+
    212				     el	msj
    213						     print
1   214	0003  B4 00			     mov ah,0
1   215	0005  B0 02			 mov al,2
1   216	0007  CD 10			 int 10h
1   217	0009  B4 09			 mov ah,09h
1   218	000B  CD 21			 int 21h
1   219					     exit
2   220	000D  B8 4C00			     mov ax, 4c00h
2   221	0010  CD 21			 int 21h
    222	0012			     showInfo EndP
    223
    224	0012			     prueba Proc far
    225					     print
1   226	0012  B4 00			     mov ah,0
1   227	0014  B0 02			 mov al,2
1   228	0016  CD 10			 int 10h
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 5
bmp2asc.ASM



1   229	0018  B4 09			 mov ah,09h
1   230	001A  CD 21			 int 21h
1   231					     exit
2   232	001C  B8 4C00			     mov ax, 4c00h
2   233	001F  CD 21			 int 21h
    234	0021			     prueba EndP
    235
    236
    237				     ;------ABRE EL ARCHIVO
    238
    239	0021			     openFile proc
    240	0021  B4 3D				     mov     ah,3dh
    241	0023  B0 02				     mov     al,02h			;establece el modo de abrir
    242	0025  BA 0000r				     lea     dx,bmp		      ;señala la direccion donde esta el nombre
    243	0028  CD 21				     int     21h
    244	002A  BA 06BFr				     mov     dx, offset	error4
    245	002D  72 E3				     jc	prueba
    246	002F  8B D8				     mov     bx,ax
    247	0031  A3 06D0r				     mov     filehandle,ax
    248	0034  C3				     ret
    249	0035			     openFile endp
    250
    251	0035			     inicio:
    252	0035  B8 0000s			     mov	     Ax,Seg LineCommand
    253	0038  50			     push    Ax
    254	0039  B8 030Ar			     lea	     Ax,LineCommand
    255	003C  50			     push    Ax
    256
    257					     exit
1   258	003D  B8 4C00			     mov ax, 4c00h
1   259	0040  CD 21			 int 21h
    260
    261
    262				     End inicio
*Warning* bmp2asc.ASM(96) Open segment:	SCODIGO
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 6
Symbol Table




Symbol Name			  Type	 Value

??DATE				  Text	 "11/19/20"
??FILENAME			  Text	 "bmp2asc "
??TIME				  Text	 "14:24:02"
??VERSION			  Number 040A
@CPU				  Text	 0101H
@CURSEG				  Text	 SCODIGO
@FILENAME			  Text	 BMP2ASC
@WORDSIZE			  Text	 2
ARCHIVO				  Byte	 SDATO:00FF
BMP				  Byte	 SDATO:0000
ERROR0				  Byte	 SDATO:0620
ERROR1				  Byte	 SDATO:0688
ERROR2				  Byte	 SDATO:0699
ERROR3				  Byte	 SDATO:06AD
ERROR4				  Byte	 SDATO:06BF
FILEHANDLE			  Word	 SDATO:06D0
INFO0				  Byte	 SDATO:0409
INFO1				  Byte	 SDATO:044B
INFO2				  Byte	 SDATO:046F
INFO3				  Byte	 SDATO:04B0
INFO4				  Byte	 SDATO:04E5
INFO5				  Byte	 SDATO:051A
INFO6				  Byte	 SDATO:0539
INFO7				  Byte	 SDATO:0561
INFO8				  Byte	 SDATO:059E
INFO9				  Byte	 SDATO:05DB
INICIO				  Near	 SCODIGO:0035
INSTRUCTION			  Byte	 SDATO:010A
LINECOMMAND			  Byte	 SDATO:030A
MSGINVBMP			  Byte	 SDATO:065A
OPENFILE			  Near	 SCODIGO:0021
OPENFILEERROR			  Byte	 SDATO:0670
PASSWORD			  Byte	 SDATO:010B
PRUEBA				  Far	 SCODIGO:0012
SHOWINFO			  Far	 SCODIGO:0000
TEXT				  Byte	 SDATO:020A
TEXTSIZE			  Byte	 SDATO:0309
TXTHANDLE			  Word	 SDATO:06D2

Macro Name

EXIT
INICIASEGDATOS
LISTPOP
LISTPUSH
POPREG
PRINT
PUSHREG

Groups & Segments		  Bit Size Align  Combine Class

SCODIGO				  16  0042 Para	  Public  CODE
SDATO				  16  06D4 Para	  Public  DATA
SPILA				  16  0240 Para	  Stack	  STACK
Turbo Assembler	 Version 4.1	    11/19/20 14:24:02	    Page 7
Error Summary



*Warning* bmp2asc.ASM(96) Open segment:	SCODIGO
